jQuery(function(t){t("#wpmm-migrate, #wpmm-rollback").on("click",function(){t.post(wpmmVars.ajaxURL,{action:"wpmm_toggle_gutenberg",source:this.parentElement.parentElement.dataset.key,_wpnonce:this.parentElement.parentElement.dataset.nonce},function(t){if(!t.success)return alert(t),!1;window.location.reload()},"json")});const a=window.location.hash;""!==a&&(t(".nav-tab-wrapper").children().removeClass("nav-tab-active"),t('.nav-tab-wrapper a[href="'+a+'"]').addClass("nav-tab-active"),t(".tabs-content").children().addClass("hidden"),t(".tabs-content div"+a.replace("#","#tab-")).removeClass("hidden"),t("body").trigger("show_"+a.replace("#","")+"_tab_content")),t(".nav-tab-wrapper").on("click","a",function(){const a=t(this).attr("href"),e=a.replace("#","#tab-");t(this).parent().children().removeClass("nav-tab-active"),t(this).addClass("nav-tab-active"),t(".tabs-content").children().addClass("hidden"),t(".tabs-content div"+e).removeClass("hidden"),t("body").trigger("show_"+a.replace("#","")+"_tab_content")}),t(".color_picker_trigger").wpColorPicker(),t(".shortcodes-list-wrapper").on("click",".toggle-shortcodes-list",function(a){a.preventDefault();const e=t(this).data("hide"),n=t(this).data("show"),s=t(this).next(".shortcodes-list");s.toggleClass("show");const o=s.hasClass("show")?e:n;t(this).text(o)}),t(".chosen-select").chosen({disable_search_threshold:10});const e={};t("body").on("click",".image_uploader_trigger",function(a){a.preventDefault();const n=t(this).data("name")||"",s=t(this).data("title")||wpmmVars.imageUploaderDefaults.title,o=t(this).data("button-text")||wpmmVars.imageUploaderDefaults.buttonText,i=t(this).data("to-selector")||"";""!==n&&""!==i?e.hasOwnProperty(n)?e[n].open():(e[n]=wp.media.frames.file_frame=wp.media({title:s,button:{text:o},multiple:!1}),e[n].on("select",function(){const a=e[n].state().get("selection").first().toJSON().url||"";t(i).val(a)}),e[n].open()):alert("Required `data` attributes: name, to-selector")});const n=function(a){t(".design_bg_types").hide(),t("#show_"+a).show()};n(t("#design_bg_type").val()),t("body").on("change","#design_bg_type",function(){const a=t(this).val();n(a)}),t("ul.bg_list").on("click","li",function(){t(this).parent().children().removeClass("active"),t(this).addClass("active")}),t("#subscribers_wrap").on("click","#subscribers-export",function(){const a=t("#tab-modules #_wpnonce").val();t("<iframe />").attr("src",wpmmVars.ajaxURL+"?action=wpmm_subscribers_export&_wpnonce="+encodeURI(a)).appendTo("body").hide()}),t("#subscribers_wrap").on("click","#subscribers-empty-list",function(){const a=t("#tab-modules #_wpnonce").val();t.post(wpmmVars.ajaxURL,{action:"wpmm_subscribers_empty_list",_wpnonce:a},function(a){if(!a.success)return alert(a.data),!1;t("#subscribers_wrap").html(a.data)},"json")}),t("body").on("click",".reset_settings",function(){const a=t(this).data("tab"),e=t("#tab-"+a+" #_wpnonce").val();t.post(wpmmVars.ajaxURL,{action:"wpmm_reset_settings",tab:a,_wpnonce:e},function(t){if(!t.success)return alert(t.data),!1;window.location.reload(!0)},"json")}),t(".countdown_start").datetimepicker({timeFormat:"HH:mm:ss",dateFormat:"dd-mm-yy"});let s="#";const o=t(".wpmm-template-image-wrap"),i=t("#wizard-buttons");function r(a){const e={_wpnonce:t("#tab-design #_wpnonce").val(),source:"tab-design",template_slug:a.dataset.slug,category:a.dataset.category};t(a).html('<span class="dashicons dashicons-update"></span>'+wpmmVars.importingText+"..."),t(".button-import").addClass("disabled").css("pointer-events","none"),o.removeClass("can-import"),t(a).parent().addClass("importing"),u(e,function(a){s=a.pageEditURL.replace(/&amp;/g,"&"),t(".importing .button-import").html(wpmmVars.importDone),c({title:wpmmVars.modalTexts.title,description:wpmmVars.modalTexts.description,first_button:`<a href="${s}" class="button button-primary button-big">${wpmmVars.modalTexts.buttonPage}</a>`,second_button:`<button class="button button-secondary button-big" onClick="window.location.reload()">${wpmmVars.modalTexts.buttonSettings}</button>`})})}function c(a){const e=t('<div class="modal-overlay"><div class="modal-frame"><div class="modal-content">'+`<h4 class="modal-header">${a.title}</h4>`+`<p class="modal-text">${a.description}</p>`+'<div class="buttons-wrap">'+a.first_button+a.second_button+"</div></div></div></div>");t("body").addClass("has-modal"),t(".modal-overlay").length?t(".modal-overlay").replaceWith(e):t(e).appendTo("body")}o.on("click",".button-import",function(){if("0"!==this.dataset.replace){c({title:wpmmVars.confirmModalTexts.title,description:wpmmVars.confirmModalTexts.description,first_button:`<button class="button button-primary button-big confirm button-import">${wpmmVars.confirmModalTexts.buttonContinue}</button>`,second_button:`<button class="button button-secondary button-big go-back">${wpmmVars.confirmModalTexts.buttonGoBack}</button>`}),t(this).parent().addClass("importing"),t(this).hide();const a=this;t("button.confirm").on("click",function(){t(this).html('<span class="dashicons dashicons-update"></span>'+wpmmVars.importingText+"..."),t(".modal-content").find(t(".go-back")).addClass("disabled"),r(a)}),t("button.go-back").on("click",function(){t(".modal-overlay").remove(),t("body").removeClass("has-modal"),t(a).show(),t(a).parent().removeClass("importing")})}else r(this)}),t('select[name="options[design][template_category]"]').on("change",function(){const a=t("#tab-design #_wpnonce").val();t.post(wpmmVars.ajaxURL,{action:"wpmm_change_template_category",category:this.value,_wpnonce:a},function(t){if(!t.success)return alert(t),!1;window.location.reload()},"json")}),t('select[name="options[design][page_id]"]').on("change",function(){const a=t("#tab-design #_wpnonce").val();t.post(wpmmVars.ajaxURL,{action:"wpmm_select_page",page_id:this.value,_wpnonce:a},function(t){if(!t.success)return alert(t.data),!1;window.location.reload()},"json")});let p=!1;const l=t('input[name="wizard-template"]'),m=t("#wpmm-wizard-wrapper .button-import");function d(a,e){t(".slider-wrap").removeClass(`move-to-${a}`).addClass(`move-to-${e}`),t(`.${a}-step`).attr("aria-hidden","true").css("display","none"),t(`.${e}-step`).removeAttr("aria-hidden").removeAttr("style")}function u(a,e){wpmmVars.isOtterInstalled?wpmmVars.isOtterActivated||b(()=>w(a,e)):function(a){t.post(wpmmVars.ajaxURL,{action:"wp_ajax_install_plugin",_ajax_nonce:wpmmVars.pluginInstallNonce,slug:"otter-blocks"},function(e){if(!e.success)return alert(e.data.errorMessage),t(".dashicons-update").remove(),t('<p class="error import-error">'+wpmmVars.errorString+"</p>").insertAfter("#wizard-buttons"),window.location.reload(),!1;t.post(wpmmVars.ajaxURL,{action:"wpmm_update_sdk_options",_wpnonce:wpmmVars.ajaxNonce},function(t){t.success||console.error(t.data)}),b(a)})}(()=>w(a,e))}function w(a,e){a.action="wpmm_insert_template",t.post(wpmmVars.ajaxURL,a,function(a){if(!a.success)return alert(a.data),t(".dashicons-update").remove(),t('<p class="error import-error">'+wpmmVars.errorString+"</p>").insertAfter("#wizard-buttons"),!1;e(a.data)},"json")}function b(a){t.get(wpmmVars.otterActivationLink,function(){a()})}t("h2.wpmm-title span").on("click",function(){window.location.href=wpmmVars.adminURL}),t('input[name="wizard-template"]:checked').val()&&t("#wpmm-wizard-wrapper .button-import").removeClass("disabled"),l.on("change",function(){m.removeClass("disabled");const a=t('input[name="wizard-template"]:checked').data("category");t("#wizard-buttons .button-skip").attr("value",a?wpmmVars.skipImportStrings[a]:wpmmVars.skipImportDefault)}),i.on("click",".button-import:not(.disabled)",function(){const a=t('input[name="wizard-template"]:checked'),e=a.val(),n=a[0].dataset.category,o={_wpnonce:wpmmVars.wizardNonce,source:"wizard",template_slug:e,category:n};!function(a){const e=t("input[value="+a+"] + .wpmm-template");e.addClass("loading"),e.append('<span class="dashicons dashicons-update"></span><p><i>'+wpmmVars.loadingString+"</i></p>"),t(".button-import").attr("disabled","disabled"),t("#wpmm-wizard-wrapper .wpmm-templates-radio label").css("pointer-events","none")}(o.template_slug),t("#wpmm-wizard-wrapper .button-skip").addClass("disabled"),u(o,function(a){d("import","subscribe"),s=a.pageEditURL.replace(/&amp;/g,"&"),t("#wpmm-wizard-wrapper .finish-step .heading").text(wpmmVars.finishWizardStrings[n]),t("#wpmm-wizard-wrapper .button-skip").removeClass("disabled")})}),i.on("click",".button-skip",function(){t.post(wpmmVars.ajaxURL,{action:"wpmm_skip_wizard",_wpnonce:wpmmVars.wizardNonce},function(t){t.success?(p=!0,d("import","subscribe")):console.error(t.data)})}),t('#email-input-wrap input[type="text"]').on("keypress",a=>{if("Enter"===a.key){t("#email-input-wrap .subscribe-button").trigger("click")}}),t("#email-input-wrap").on("click",".subscribe-button",function(a){a.preventDefault();const e=t('#email-input-wrap input[type="text"]'),n=e.val(),s=t(this);return function(t){const a=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(t.toLowerCase()));return t.length>7&&!0===a}(n)?(e.removeClass("invalid"),s.addClass("is-busy"),t.post(wpmmVars.ajaxURL,{action:"wpmm_subscribe",email:n,_wpnonce:wpmmVars.wizardNonce},function(t){t.success||alert(t.data),s.removeClass("is-busy"),p?window.location.reload():d("subscribe","finish")}),!1):(t("#email-input-wrap").append(`<p class="subscribe-message email-error"><i>${wpmmVars.invalidEmailString}</i></p>`),e.addClass("invalid"),void setTimeout(function(){t(".email-error").remove()},1500))}),t("#skip-subscribe").on("click",function(){p?window.location.reload():d("subscribe","finish")}),t("#view-page-button").on("click",function(){window.location.href=s}),t("#refresh-button").on("click",function(){window.location.reload()})});